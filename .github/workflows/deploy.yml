name: Salesforce CI/CD
 
on:
 push:
   branches:
     - master
 
jobs:
 deploy:
   runs-on: ubuntu-latest
 
   steps:
     - name: ðŸ“¥ Checkout code
       uses: actions/checkout@v3
 
     - name: ðŸ›  Install Salesforce CLI
       run: npm install -g sfdx-cli
 
     - name: ðŸ” Authenticate Dev Hub
       run: |
         echo "${{ secrets.SFDX_AUTH_URL_DEVHUB }}" > authUrl.txt
         cat authUrl.txt  # Optional debug
         sfdx force:auth:sfdxurl:store -f authUrl.txt -a DevHub
 
     - name: ðŸ“¦ Auto-commit changes (if any)
       run: |
         git config --global user.email "shweta.yenaji@zensar.com"
         git config --global user.name "shwetayenaji"
         git add --all
         git reset authUrl.txt  # Unstage the secret file
         git diff-index --quiet HEAD || git commit -m "Auto-commit: New changes detected"
         git remote set-url origin https://x-access-token:${{ secrets.GH_TOKEN }}@github.com/shwetazensar/sfdx-project.git
         git push origin main
       continue-on-error: true
 
     - name: ðŸš€ Deploy to Salesforce
       run: |
           sfdx force:source:deploy -p force-app -u DevHub --testlevel RunLocalTests
